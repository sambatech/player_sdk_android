version: 2
jobs:
   buildSonar:
     working_directory: ~/player_sdk_android
     docker:
       - image: circleci/android:api-28
     environment:
         JVM_OPTS: -Xmx3200m
     steps:
       - checkout
       - run:
           name: Config Licenses
           command: cp -R assets/licenses $ANDROID_HOME/
       - restore_cache:
          key: jars-{{ checksum "build.gradle" }}-{{ checksum  "sambaplayersdk/build.gradle" }}
       - run:
          name: Download Dependencies
          command: ./gradlew androidDependencies
       - save_cache:
          paths:
             - ~/.gradle
          key: jars-{{ checksum "build.gradle" }}-{{ checksum  "sambaplayersdk/build.gradle" }}
       - run:
          name: Android Lint
          command: ./gradlew sambaplayersdk:lintRelease
       - run:
          name: Generate Release
          command: cd sambaplayersdk && ../gradlew assembleRelease --stacktrace


workflows:
  version: 2
  player-sdk-android:
    jobs:
      - buildSonar
      - deploy:
          filters:
            branches:
              only:
                - dev
                - master
